{
  "name": "heartbeat-skeleton",
  "version": 1,
  "vars": {
    "TMP": "/tmp/crayfish-heartbeat"
  },
  "steps": [
    {
      "id": "mk_tmp",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "mkdir -p '{{vars.TMP}}'"
        ]
      }
    },
    {
      "id": "fetch",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "# TODO: fetch raw items from your source and write JSON to TMP\necho '{\"items\":[]}' > '{{vars.TMP}}/items_raw.json'\necho '{{vars.TMP}}/items_raw.json'"
        ]
      }
    },
    {
      "id": "normalize",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "# TODO: normalize raw items into a stable structure\necho '{\"items\":[]}' > '{{vars.TMP}}/items_norm.json'\necho '{{vars.TMP}}/items_norm.json'"
        ]
      }
    },
    {
      "id": "cluster",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "# TODO: group/cluster normalized items if needed\necho '{\"clusters\":[]}' > '{{vars.TMP}}/clusters.json'\necho '{{vars.TMP}}/clusters.json'"
        ]
      }
    },
    {
      "id": "gate",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "# TODO: decide which clusters/items need an agent step\necho '{\"approved\":false,\"reasons\":[]}' > '{{vars.TMP}}/gate.json'\necho '{{vars.TMP}}/gate.json'"
        ]
      }
    },
    {
      "id": "verify",
      "kind": "agent",
      "assigneeAgentId": "primary",
      "session": {
        "mode": "sticky",
        "label": "wf:heartbeat:primary"
      },
      "prompt": "Deep verification for Top items. Output STRICT JSON only (no markdown).",
      "input": {
        "clustersPath": "{{vars.TMP}}/clusters.json",
        "gatePath": "{{vars.TMP}}/gate.json"
      },
      "schema": {
        "$ref": "Verify"
      },
      "retries": 3
    },
    {
      "id": "analyze",
      "kind": "agent",
      "assigneeAgentId": "primary",
      "session": {
        "mode": "sticky",
        "label": "wf:heartbeat:primary"
      },
      "prompt": "Analysis: facts → mechanism → probabilities → impacts → risks → watchpoints. Output STRICT JSON only (no markdown).",
      "input": {
        "clustersPath": "{{vars.TMP}}/clusters.json",
        "verifyStepId": "verify"
      },
      "schema": {
        "$ref": "Analysis"
      },
      "retries": 3
    },
    {
      "id": "render",
      "kind": "exec",
      "run": {
        "kind": "cmd",
        "cmd": "bash",
        "args": [
          "-lc",
          "# TODO: node pipeline/stages/09_render_analysis.js ...\necho '{\"text\":\"\"}' > '{{vars.TMP}}/render.json'\ncat '{{vars.TMP}}/render.json'"
        ]
      }
    }
  ]
}